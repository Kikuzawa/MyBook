### О курсоре

**Курсор** (англ. `cursor`) — *управляющая структура*, которая *производит* **обход записей** (англ. `traversal`) в *базе данных*. 

<!--
Также *курсором* называют *область памяти*, которая *хранит результат поискового запроса* к *базе данных*.
-->

*Принцип работы* с *курсором похож* на работу с *итератором* (англ. `iterator`), поскольку *курсор позволяет последовательно обработать каждую строку* (каждый документ) из *выбранного набора строк* (документов).

*Курсор* также можно *рассматривать* как *указатель* (`pointer`) на *одну строку таблицы* (на один документ). *Курсор* может *ссылаться* только на *одну строку* (один документ) в *один момент времени*, но может *перемещаться* к *другим строкам* при необходимости.

*Курсоры подразделяются* на *явные* и *неявные*.

**Явный курсор** *создаётся разработчиком вручную*, **неявный курсор** *создаётся системой автоматически*.

### Пример курсора в MongoDB
```js
const usersCursor = db.users.find({ role: 'admin' });
/* последовательный перебор всех документов результирующего набора в цикле while */
while (usersCursor.hasNext()) {
   const user = usersCursor.next();
   console.log(user);
}
```

### Пример курсора в SQL
```SQL
# объявление временных переменных, которые будут использованы для записи данных курсора
DECLARE @id VARCHAR(50);
DECLARE @role VARCHAR(50);
# объявление явного курсора, который будет брать данные столбцов id, role из таблицы users
DECLARE @users_cursor CURSOR FOR
  SELECT id, role
  FROM users
# открытие курсор (наполнение его данными)
OPEN @users_cursor
# последовательное извлечение строк из результирующего набора в цикле WHILTE,
# запись значений в переменные и вывод этих переменных 
WHILE @@FETCH_STATUS = 0
BEGIN
  FETCH NEXT FROM @users_cursor INTO @id, @role
  PRINT @id + ' ' + @role
END
# после извлечения всех строк следует закрыть курсор и освободить занимаемые им ресурсы
CLOSE @users_cursor
# иногда нужно вручную освобождать память курсора (зависит от реализации SQL)
DEALLOCATE @users_cursor
```
Возможные варианты перемещений с `FETCH` по результирующему набору строк.
* `FIRST` — первая строка .
* `NEXT` — следующая строка после текущей.
* `PRIOR` — строка, находящаяся перед текущей.
* `LAST` — последняя строка.
* `ABSOLUTE int` — строка по её абсолютному порядковому номеру `int` при отсчёте с начала (конца), если перед `int` знак + (-). Если указать 0, то ничего не вернётся.
* `RELATIVE int` — перемещение на `int` строк вперёд (назад) от текущей, если перед `int` знак + (-). Если указать 0, то вернётся текущая строка.

Изменение данных таблицы при помощи курсора и `CURRENT`. Курсор должен быть открыт для операции.
```SQL
UPDATE new_users
SET ...
WHERE CURRENT OF @sers_cursor
```
Аналогично можно делать с `DELETE`.


