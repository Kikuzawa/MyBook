## Нормализация и нормальные формы
- [О нормальной форме и нормализации](#о-нормальной-форме-и-нормализации)
- [О денормализации](#о-денормализации)
- [Первая нормальная форма](#первая-нормальная-форма)




### О нормальной форме и нормализации

**Нормальной формой** (англ. `normal form`) называют некоторое *требование* или *совокупность требований*, которым *должно удовлетворять отношение* для *устранения избыточности*.

Если эти *требования выполняются* для *каждого отношения* некоторой *базы данных*, то её называют **нормализованной базой данных** (англ. `normalized database`). Сам *процесс приведения базы данных* к *нормализованному виду* называется **нормализацией** этой **базы данных** (англ. `database normalization`).

*Нормализация позволяет избежать избыточности данных*, то есть *исключить дублирование данных*. *Дублирование данных* в свою очередь может стать причиной ошибок при изменении данных.

*Понятие нормализации ввёл Эдгад Кодд* как *часть* своей *реляционной модели*.

### О денормализации

**Денормализацией базы данных** (англ. `database denormalization`) называют *процесс*, *обратный нормализации*. В этом случае в *базу данных умышленно добавляют избыточные данные* (*дубликаты данных*) для *ускорения получения данных*.

Когда *отношений слишком много* и они *тесно связаны* друг с другом, *группировка* (*операция соединения*) *данных* может *занимать продолжительное время* (скажем, сделать *соединение* `INNER JOIN` *десяти таблиц*), что *плохо сказывается* на *производительности системы*, а значит и на *пользовательском опыте*. 

По этой причине данные иногда умышленно хранят в денормализованном виде, когда одна одношение представляет собой композицию нескольких отношений.

Денормализованный вид усложняет операции создания, обновления и удаления данных (ведь нужно изменять не только сами данные, но и все их дубликаты), а также увеличивает размер базы данных. Зато существенно снижается время отклика системы при чтении данных.

*Ниже* представлен *пример денормализации* в *табличном виде*.

#### Публикация (дублирует только те поля пользователя, которые нужны для отображения на странице)
ID | Заголовок | Текст | Автор
:--: | :--: | :--: | :--:
`N1` | Нормализация | Нормализацией базы данных называют.... | ID: `U1` <br /> Никнейм: `@max.starling` <br /> Почта: `max.starling@email`
`N2` | Денормализация | Денормализацией базы данных называют.... | ID: `U1` <br />   Никнейм: `@max.starling` <br />   Почта: `max.starling@email`
`N3` | Реляционная модель данных | Реляционной моделью данных называют.... | ID: `U2` <br />   Никнейм: `@ray.gray` <br />   Почта: `ray.gray@email`

#### Пользователь (хранит идентицикаторы публикаций, чтобы публикации было проще найти на странице пользователя)
ID | Никнейм | Почта | Возраст | Публикации
:--: | :--: | :--: | :--: | :--:
`U1` | @max.starling | max.starling@mail | 23 | [`N1`, `N2`]
`U2` | @ray.gray | ray.gray@mail | 27 | [`N3`]

*Ниже* представлен *пример денормализации* в *документном виде*.

#### Публикации в формате JSON
```js
[{
  "_id": "N1",
  "title": "Нормализация",
  "text": "Нормализацией базы данных называют....",
  "user": {
    "_id": "U1",
    "username": "@max.starling",
    "email": "max.starling@email"
  }
},
{
  "_id": "N2",
  "title": "Денормализация",
  "text": "Денормализацией базы данных называют....",
  "user": {
    "_id": "U1",
    "username": "@max.starling",
    "email": "max.starling@email"
  }
},
{
  "_id": "N3",
  "title": "Реляционная модель данных",
  "text": "Реляционной моделью данных называют....",
  "user": {
    "_id": "U2",
    "username": "@ray.gray",
    "email": "ray.gray@email"
  }
}]
````

#### Пользователи в формате JSON
```js
[{
  "_id": "U1",
  "username": "@max.starling",
  "email": "max.starling@email",
  "age": 23,
  "posts: ["N1", "N2"]
}, {
  "_id": "U2",
  "username": "@ray.gray",
  "email": "ray.gray@email",
  "age": 27,
  "posts: ["N3"]
}]
````


### Первая нормальная форма
*Отношение находится* в **первой нормальной форме** (англ. `first normal form`), **1НФ** (англ. `1NF`) тогда и только тогда, когда *любой кортеж отношения* может *содержать только одно значение* для *каждого* из *атрибутов*.

Таким образом, *значение атрибута не может быть представлять собой набор значений* (массив, множество, таблицу и так далее), если *отношение находится* в *1НФ*.

В *реляционной модели данных* *отношение всегда находится* в *1НФ* по своему *определению*. 

Тем не менее, некоторые *таблицы*, которыми можно *представить отношение*, могут *не удовлетворять данному требованию*, а значит и *реляционной модели*.

Например, `SQL` *не поддерживает использование столбцов* с *табличными значениями* (англ. `table-valued columns`).

Пример *ненормализованной таблицы*:
Страна | Город
:--: | :--:
Россия | Москва, Санкт-Петербург
Украина | Киев, Львов
Беларусь | Минск

Пример *нормализованной таблицы*:
Страна | Город
:--: | :--:
Россия | Москва
Россия | Санкт-Петербург
Украина | Киев
Украина | Львов
Беларусь | Минск

*Базы данных*, которые *нарушают первую нормальную форму*, обычно называют `NoSQL` *базами данных*. Примером такой базы данных является документная база данных `MongoDB`, которая *позволяет хранить любые JSON-документы* (значения могут быть массивами или объектами).

