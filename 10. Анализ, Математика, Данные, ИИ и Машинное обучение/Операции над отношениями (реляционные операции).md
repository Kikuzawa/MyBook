## Операции над отношениями (реляционные операции)
- [О реляционных операциях](#о-реляционных-операциях)
- [Ограничения на применение операций](#ограничения-на-применение-операций)
- [Объединение отношений](#объединение-отношений)
- [Пересечение отношений](#пересечение-отношений)
- [Вычитание отношения](#вычитание-отношения)
- [Декартово произведение отношений](#декартово-произведение-отношений)
- [Проекция отношения](#проекция-отношения)
- [Выборка (ограничение)](#выборка-ограничение)
- [Соединение](#соединение)
- [Деление отношений](#деление-отношений)
- [Переименование атрибутов отношения](#переименование-атрибутов-отношения)

### О реляционных операциях


*Большинство операций над отношениями* являются *бинарными*, то есть такими, которые *оперируют двумя отношениями*. При необходимости *произвести бинарную операцию над большим количеством отношений*, её необходимо *применить последовательно несколько раз*: `P • R • S • T = ((P • R) • S) • T`.


*Любая операция над отношениями*, *результатом* которой является *отношение*, называется **реляционной операцией**.

*Систему реляционных операций* называют **реляционной алгеброй**.

Можно придумать *бесконечно много реляционных операций*, но *абсолютное большинство* из них будут *выражаться через другие* реляционных операции, то есть *будут являться результатом последовательного применения нескольких* более простых *реляционных операции*.

*Эдгар Кодд*, *создатель реляционной модели данных*, *ввёл* следующий *набор из 8 реляционных операций*:  
- [Объединение отношений](#объединение-отношений)
- [Пересечение отношений](#пересечение-отношений)
- [Вычитание отношения](#вычитание-отношения)
- [Декартово произведение отношений](#декартово-произведение-отношений)
- [Проекция отношения](#проекция-отношения)
- [Выборка (ограничение)](#выборка-ограничение)
- [Соединение](#соединение)
- [Деление отношений](#деление-отношений)

Операции *объединения*, *пересечения*, *вычитания* и *декартова произведения* относят к **теоретико-множественным операциям**: они являются *аналогами одноимённых операций над множествами* в *теории множеств*.

Операции *проекции*, *выборки*, *соединения* и *деления* называют **специальными операциями**: они *имеют смысл только* в рамках *реляционной модели данных*.

Операции *объединения*, *вычитания*, *проекции*, *декартова произведения* и *выборки* являются **примитивными реляционными операциями** — такими *операциями*, которые *нельзя выразить друг через друга*. 

Далее *в примерах отношения* будут *представляться таблицами* для *наглядности*.


### Ограничения на применение операций

Операции *объединения*, *пересечения* и *вычитания требуют совпадения заголовков* у своих *отношений-операндов*. 

Операции *декартова произведения* и *соединения* требуют, чтобы *в заголовках* их отношений-операндов *не было совпадающих названий атрибутов*. Если таковые *имеются*, то их *необходимо переименовать до применения операции*.

### Объединение отношений

**Объединения отношений `R` и `S`** - *бинарная операция*, *требующая совпадения заголовков* отношений `R` и `S`, *результатом* которой является *отношение* с *тем же заголовком* и *телом*, *содержащим все кортежи обоих отношений*. Иначе говоря, *каждый кортеж* отношения-результата *принадлежит или* отношению `R`, *или* отношению `S`. Если *отношения* `R` и `S` *имеют между собой совпадающие кортежи* (*пересечения*), то в *отношение-результат* попадает только один из них.

*Обозначение объединения отношений* `R` и `S`: `R UNION S`.

*Объединение отношений* является *аналогом объединения множеств* из *теории множеств*.

*Ниже* представлен *пример объединения отношений* `R` и `S`.

#### Отношение `R`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Сара | программист | 2020

#### Отношение `S`
Имя | Профессия | Дата
:--: | :--: | :--:
Рози | дизайнер | 2020
Сара | программист | 2020

#### Отношение `R UNION S`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Сара | программист | 2020
Рози | дизайнер | 2020

### Пересечение отношений

**Пересечение отношений `R` и `S`** - *бинарная операция*, *требующая совпадения заголовков* отношений `R` и `S`, *результатом* которой является *отношение* с *тем же заголовком* и *телом*, *содержащим только* те *кортежи*, которые *содержатся в обоих отношений*. Иначе говоря, *каждый кортеж* отношения-результата *содержится и в* отношении `R`, *и в* отношении `S`.


*Обозначение пересечения отношений* `R` и `S`: `R INTERSECT S`.

*Пересечение отношений* является *аналогом пересечения множеств* из *теории множеств*.

Операция *пересечения отношений не является примитивной*, поскольку её можно *выразить через операцию вычитания отношения*: `R INTERSECT S` = `R MINUS (R MINUS S)`.

*Ниже* представлен *пример пересечения отношений* `R` и `S`.

#### Отношение `R`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Сара | программист | 2020

#### Отношение `S`
Имя | Профессия | Дата
:--: | :--: | :--:
Рози | дизайнер | 2020
Сара | программист | 2020

#### Отношение `R INTERSECT S`
Имя | Профессия | Дата
:--: | :--: | :--:
Сара | программист | 2020


### Вычитание отношения


**Вычитание отношения `S` из `R`** - *бинарная операция*, *требующая совпадения заголовков* отношений `R` и `S`, *результатом* которой является *отношение* с *тем же заголовком* и *телом*, *содержащим только* те *кортежи*, которые *принадлежат* отношению `R`, но *не принадлежат* отношению `S`. 


*Обозначение вычитания* отношения `S` из `R`: `R MINUS S`.

*Вычитание отношения* является *аналогом разности множеств* из *теории множеств*.

*Ниже* представлен *пример вычитания отношения* `S` из `R`.

#### Отношение `R`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Сара | программист | 2020

#### Отношение `S`
Имя | Профессия | Дата
:--: | :--: | :--:
Рози | дизайнер | 2020
Сара | программист | 2020

#### Отношение `R MINUS S`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019

### Декартово произведение отношений

Пусть *имеются отношение* `R` с *атрибутами* `a1, a2, ..., an` и *значениями атрибутов* `x1, x2, ..., xn` в кортежах и *отношение* `S` с *атрибутами* `b1, b2, ..., bm` и *значениями атрибутов* `y1, y2, ..., ym` в кортежах.

**Декартово произведение отношений `R` и `S`** - это *бинарная операция*, *требующая отсутствия совпадающих названий атрибутов между заголовками отношений* `R` и `S` (между `{ a1, a2, ..., an }` и `{ b1, b2, ..., bm }`), *результатом* которой является *новое отношение* `T`, *заголовок* которого получается в *результате конкатенации* (соединения, сцепления) *заголовков отношений* `R` и `S`, а *тело состоит из упорядоченных пар* `((x1, x2, ..., xn), (y1, y2, ..., ym))`, *содержащих всевозможные комбинации кортежей отношений* `R` и `S` *соответственно*. Для *упрощения* можно *раскрыть скобки* внутри *упорядоченной пары* (*порядок элементов сохранится*): `(x1, x2, ..., xn, y1, y2, ..., ym)`.

*Обозначение декартова произведения* `R` и `S`: `R TIMES S`.


*Декартово произведение отношений* является *аналогом декартова произведения множеств* из *теории множеств*.


*Ниже* представлен *пример декартова произведения отношений* `R` и `S`.

#### Отношение `R(Имя, Фамилия)`
Имя | Фамилия
:--: | :--:
Ася | Тургенева
Рози | Фицджеральд
Сара | Фаулз

#### Отношение `S(Профессия, Дата)`
Профессия | Дата
:--: | :--:
дизайнер | 2019
программист | 2020

*Количество атрибутов* в *отношении* `R TIMES S`: `n(R) + n(S) = 2 + 2 = 4`, *количество кортежей*: `m(R) • m(S) = 3 • 2 = 6`.

#### Отношение `R TIMES S = T(Имя, Фамилия, Профессия, Дата)`
Имя | Фамилия | Профессия | Дата
:--: | :--: | :--: | :--:
Ася | Тургенева | дизайнер | 2019
Ася | Тургенева | программист | 2020
Рози | Фицджеральд | дизайнер | 2019
Рози | Фицджеральд | программист | 2020
Сара | Фаулз | дизайнер | 2019
Сара | Фаулз | программист | 2020


### Проекция отношения

**Проекция отношения `R`** - *унарная операция над отношением* `R`, которая позволяет *составить новое отношение* из *выбранных атрибутов* отношения `R` *и их значений* в *кортежах* отношения `R`.

<!--
*результатом* которой является *новое отношение* `R'`, содержащее в своём заголовке лишь выбранные атрибуты отношения `R`, а в своём теле - все кортежи отношения `R` с исключением тех значений атрибутов, атрибуты которых не вошли в проекцию. 
-->

*Графически* *проекция отношения* `R` - это *выборка столбцов таблицы*.

Если *при проецировании возникают кортежи-дубликаты*, то они *удаляются из результата*.

Если *отношение* `R` *имеет* `n` *атрибутов*, то его можно *обозначить*: `R(a1, a2, ..., an)`. Тогда *проекция*, *включающая* в себя *первый* и *третий атрибуты* отношения `R` *обозначается*: `PROJECT R { a1, a3 }` или `R[a1, a3]`.

*Ниже* представлен *пример проекции отношения* `R`.

#### Отношение `R(Имя, Профессия, Дата)`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Рози | дизайнер | 2019
Сара | программист | 2020
Рози | дизайнер | 2020

#### Отношение `R[Имя, Профессия]`
Имя | Профессия
:--: | :--: 
Ася | дизайнер
Рози | дизайнер
Сара | программист
~~Рози~~ | ~~дизайнер~~

*Перечёркнутая строка* является *дубликатом второй строки*, поэтому она *не попадает в результат*.


### Выборка (ограничение)

**Выборка из** (*ограничение*, *селекция*) **отношения `R`** - *унарная операция* над отношением `R`, *результатом* которой является *отношение* с *тем же заголовком*, что и у `R`, *содержащее* в своём теле те *кортежи* из `R`, которые *удовлетворяют* некоторому *условию* `c`.

*Условие* `c` *задаётся логическим выражением* (его *результатом* являются *истина или ложь*), которое может *содержать названия атрибутов* и *константы* (числа, строки, даты и так далее). Если *результат выполнения выражения* `c` - *истина*, то *кортеж попадает в результат выборки*, *иначе* - *не попадает*.

*Обозначение выборки из отношения* `R`: `R WHERE c`.

*Ниже* представлен *пример выборки из отношения* `R`.

#### Отношение `R`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Сара | программист | 2020
Рози | дизайнер | 2020

#### Отношение `R WHERE (Профессия = дизайнер)`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Рози | дизайнер | 2020

#### Отношение `R WHERE (Дата > 2019)`
Имя | Профессия | Дата
:--: | :--: | :--:
Сара | программист | 2020
Рози | дизайнер | 2020

#### Отношение `R WHERE (Имя != Рози)`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Сара | программист | 2020

### Соединение

**Соединение** отношений `R` и `S` - *бинарная операция*, *результатом* которой является *результат последовательного применения* операций *декартового произведения* `R TIMES S` и *выборки* из *получившегося отношения* с *условием* `c`.

Как и в случае с декартовым произведением, *в заголовках* отношений `R` и `S` *не должно быть совпадающих атрибутов*. *Если* такие *имеются*, то их *необходимо переименовать перед* тем, как производить операцию *соединения*.

Обозначение *соединения* отношений `R` и `S`: `(R TIMES S) WHERE c`.


Одним из *самых простых соединений* является то *соединение*, *в условии* которого используются *константа* (например, число или строка) и *один атрибут* одного из отношений-операндов соединения. Такое *соединение отношений* `R` и `S` представлено на *примере ниже*.


#### Отношение `R`
Имя | Фамилия
:--: | :--:
Ася | Тургенева
Рози | Фицджеральд
Сара | Фаулз

#### Отношение `S`
Профессия | Дата
:--: | :--:
дизайнер | 2019
программист | 2020

#### Отношение `R TIMES S`
Имя | Фамилия | Профессия | Дата
:--: | :--: | :--: | :--:
Ася | Тургенева | дизайнер | 2019
Ася | Тургенева | программист | 2020
Рози | Фицджеральд | дизайнер | 2019
Рози | Фицджеральд | программист | 2020
Сара | Фаулз | дизайнер | 2019
Сара | Фаулз | программист | 2020


#### Отношение `(R TIMES S) WHERE (Дата = 2019)`
Имя | Фамилия | Профессия | Дата
:--: | :--: | :--: | :--:
Ася | Тургенева | дизайнер | 2019
Рози | Фицджеральд | дизайнер | 2019
Сара | Фаулз | дизайнер | 2019

### Деление отношений

 
Пусть *имеются отношение* `R` с *заголовком* `{ a1, a2, ..., an, b1, b2, ... bm }` и *телом*, *содержащим* множество *кортежей* вида `(x1, x2, ... xn, y1, y2, ... ym)`, и *отношение* `S` с *заголовком* `{ b1, b2, ... bm }` и *телом*, содержащим множество *кортежей* вида `(y1, y2, ... ym)`. 

**Делением отношения `R` на отношение `S`** называют *бинарную операцию* над отношениями `R` и `S`, *результатом* которой является *отношение* `T` с *заголовком* `{ a1, a2, …, an }` и *телом*, *содержащим* множество таких *кортежей* `(x1, x2, …, xn)`, что *для каждого кортежа* `(y1, y2, …, ym)` отношения `S` в `R` *существует кортеж* `(x1, x2, …, xn, y1, y2, …, ym)`. В этом случае *отношение* `R` *называют* **делимым**, *отношение* `S` - **делителем**, *отношение* `T` - **частным**.

<!--
Другими словами, в *результат деления* `R` на `S` *попадают такие* значения `x1, x2, ... xn` атрибутов `{ a1, a2, ..., an }` из отношения `R`, для которых *соответствующие кортежи* `(x1, x2, ..., xn, y1, y2, ... ym)` отношения `R` *включают все без исключения значения* `y1, y2, ... ym` *атрибутов* `{ b1, b2, ... bm }` из отношения `S`.
-->


Другими словами, в *результат деления отношения* `R` *на отношение* `S` *попадают такие* кортежи `x = (x1, x2, ... xn)` *делимого* `R`, c которыми *каждый кортеж* `y = (y1, y2, …, ym)` *делителя* `S` (то есть *все кортежи* отношения `S` *без исключения*) *состоит в упорядоченной паре* `(x, y)`, или, что *то же самое*, в кортеже `(x1, x2, ..., xn, y1, y2, ..., ym)`, *принадлежащим отношению `R`*.


*Обозначение деления отношения* `R` *на* `S`: `R DIVIDEBY S`.


Чем *деление отношений похоже* на *деление чисел*? При *делении чисел* `x ÷ y` мы считаем, *сколько раз делитель* `y` *целиком поместится* в *делимое* `x`. Пример: `7 ÷ 3 = 3 + 3 + 1 = 2 полных раза`. При *делении отношений* в *результат* попадает *каждый кортеж* `x`, который *связан упорядоченными парами* со *всеми без исключения* кортежами `y`, *заданными* в *отношении-делителе*.

*Деление отношений проще понять на примере*. *Ниже* представлен *пример деления* отношения `R` *на* отношение `S`.


#### Отношение `R`
Имя | Работа | Разговорный язык
:--: | :--: | :--:
Ася | дизайнер | русский
Ася | дизайнер | немецкий
Сара | программист | английский
Сара | программист | французский
Дина | программист | русский
Дина | программист | итальянский
Дина | программист | английский
Рози | дизайнер | русский
Рози | дизайнер | английский

#### Отношение `S`
Разговорный язык
:--:
русский
английский

*Кто из сотрудников компании* в отношении `R` *знает все перечисленные* в отношении `S` *языки*?

#### Отношение `R DIVIDEBY S`
Имя | Работа
:--: | :--:
Сара | программист
Рози | дизайнер

*Сара* и *Рози знают все перечисленные языки*.

Кортежи `x = (x1, x2) = (Сара, программист)` и `x = (x1, x2) = (Рози, дизайнер)` *попали в результат*, поскольку *они состоят* в *упорядоченных парах* с *каждым из кортежей* `y = (y1) = (русский)`, `y = (y1) = (английский)` отношения `S`.

В *отличие* от *остальных операций*, *предложенных Эдгаром Коддом*, *деление отношений* *не обрело широкой популярности* и *используется крайне редко*. *Такой же результат* можно *получить комбинацией* операций *выборки и проекции* - такой подход будет *гораздо гибче*.


### Переименование атрибутов отношения

**Переименование атрибутов отношения `R`** - *унарная операция* над отношением `R`, *результатом* которой является отношение с телом отношения `R` и изменёнными названиями указанных атрибутов в заголовке.

Результатом применения операции переименования атрибутов является отношение с изменёнными именами атрибутов.

*Обозначение переименования атрибутов* `{ a1, a2, ..., am }` отношения `R` *на новые имена* `{ b1, b2, ..., bm }`: `R RENAME a1, a2, …, an AS b1, b2, …, bn`.

#### Отношение `R`
Имя | Профессия | Дата
:--: | :--: | :--:
Ася | дизайнер | 2019
Сара | программист | 2020
Рози | дизайнер | 2020

#### Отношение `R RENAME Профессия, Дата AS Специальность, Год`
Имя | Специальность | Год
:--: | :--: | :--:
Ася | дизайнер | 2019
Сара | программист | 2020
Рози | дизайнер | 2020
