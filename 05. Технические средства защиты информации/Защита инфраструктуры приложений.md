#разбить_на_части

# [[Виртуализация]]


Отказоустойчивый - с обработкой отказа, хотя сегодня все чаще употребляется иной термин - высокой доступности (high availability)

По схеме работы узлы могут работать в режиме активный-пассивный или активный-активный. В первом случае все клиентские запросы обслуживаются одним из узлов, второй узел вступает в работу только при отказе первого. Второй вариант предусматривает обработку клиентских запросов обоими узлами, при этом также можно осуществлять балансировку нагрузки и увеличивать вычислительные ресурсы, путем добавления новых узлов кластера. В случае отказа одного из узлов клиентские запросы обрабатывают оставшиеся ноды.


![[Pasted image 20241006111202.png]]
# Обеспечение безопасности в Облачных инфраструктурах

Облачная безопасность предоставляет организациям подход к решению проблем безопасности и обеспечивает соблюдение нормативных требований. Эффективное обеспечение безопасности облака требует наличия нескольких уровней защиты в рамках стека облачных технологий, в который входят следующие:
- Средства превентивного контроля, предназначенные для блокировки авторизованного доступа к конфиденциальным системам и данным.
- Средства детективного контроля, предназначенные для выявления несанкционированного доступа к системам и данным и их изменений посредством проведения аудита, мониторинга и отчетности.
- Средства автоматического контроля, предназначенные для предотвращения, обнаружения и реагирования на обновления безопасности, как регулярные, так и критически важные.
- Средства административного контроля, разработанные для контроля за применением политик, стандартов, практик и процедур безопасности. 

Машинное обучение и искусственный интеллект позволяют дополнить портфель систем облачной безопасности технологиями контекстной осведомленности.

## Какие еще требования важны для обеспечения безопасности облачных данных?

- Общая ответственность за безопасность и доверие: доверие имеет первостепенное значение при выборе партнера по облаку, который будет отвечать за свою часть модели общей безопасности. Организации должны четко понимать свои роли и обязанности, а также иметь доступ к независимым сторонним аудитам и аттестациям систем безопасности.
- Автоматизация и машинное обучение: облачные угрозы несутся со скоростью автомобиля, а традиционные корпоративные системы безопасности могут анализировать инциденты и реагировать на них со скоростью человека. Современная система безопасности в облачных средах должна автоматизировать обнаружение угроз и реагирование на них. Для сложных угроз требуются новые современные решения безопасности, которые способны прогнозировать, предотвращать, обнаруживать угрозы и и реагировать на них с помощью машинного обучения.
- Эшелонированная защита: многоуровневая система безопасности по всему технологическому стеку должна включать средства превентивного, детективного и административного контроля за соответствующими людьми, процессами и технологиями для обеспечения безопасности физических центров обработки данных поставщиков облачных услуг.
- Управление учетными записями: по мере того как мобильные устройства, приложения и сведения о пользователях используются все шире, учетные записи становятся новым периметром. Важнейшее значение имеет контроль доступа и привилегий в облаке и локальных системах.
- Прозрачность: брокер защиты доступа в облако и решение для управления средствами обеспечения безопасности в облаке увеличивают прозрачность и контроль над всей облачной средой организации.
- Постоянное соответствие требованиям: соответствие нормативным требованиям является обязательным, но соответствие и безопасность – это не одно и то же. Организации могут нарушить нормативные требования, не нарушая при этом безопасность, например, в результате изменений и ошибок конфигурации. Для компаний очень важно иметь решение по управлению облачными средами, которое предоставляет полные, своевременные и действенные данные, связанные с соблюдением нормативных требований, по всем облачным средам.
- Безопасность по умолчанию: поставщик облачных услуг должен активировать средства контроля безопасности по умолчанию, а не требовать от предприятия помнить о том, что их нужно включать. Не все имеют четкое представление о различных средствах управления безопасностью и о том, как они работают вместе для снижения риска и создания полноценной системы безопасности. Например, шифрование данных должно быть включено по умолчанию. В облаках должны применяться согласованные средства контроля и политики защиты данных.
- Мониторинг и миграция: для обеспечения безопасности рабочих нагрузок администраторам политик безопасности следует настроить и обеспечить соблюдение политик безопасности для облачных пользователей и секций. Унифицирование представление всех средств контроля облачной безопасности по всем пользователям облака также необходимо для обнаружения ошибок конфигурации ресурсов и небезопасных действий по всем пользователям, что предоставляет администраторам безопасности возможность отслеживать и решать проблемы безопасности облака.
- Разделение обязанностей и доступ с минимальными привилегиями: принципы разделения обязанностей и доступа с минимальными привилегиями – это практические рекомендации по безопасности, которые следует применять в облачных средах. Таким образом Вы сможете гарантировать, что отдельные лица не будут обладать чрезмерными административными правами и не смогут получить доступ к конфиденциальным данным без дополнительной авторизации

# МНОГОУРОВНЕВАЯ ЗАЩИТА БЕЗОПАСНОСТИ ОБЛАЧНОЙ ИНФРАСТРУКТУРЫ

Один из способов обеспечения безопасности облачной инфраструктуры — создание многоуровневой защиты. В ее состав входят следующие элементы:
- физическая защита дата-центров, доступ к серверам, системам охлаждения, электропитанию и прочим физическим ресурсам;
- инфраструктурная безопасность: применение сетевых брандмауэров, систем обнаружения вторжений, виртуальных частных сетей (VPN) и иных механизмов;
- управление доступом и идентификация, управление привилегиями, ролевая модель доступа и другие механизмы, чтобы обеспечить авторизованный доступ к данным и ресурсам;
- информационная безопасность облачных технологий, к которой относятся методы, обеспечивающие защиту данных от третьих лиц: шифрование, предотвращение утечки и т. д; 
- мониторинг и анализ, позволяющие обнаруживать подозрительную активность, атаки или нарушения; 
- управление рисками и соответствие требованиям: оценка рисков, разработка политик безопасности, проведение аудитов и соблюдение соответствующих нормативных требований.

# Docker, оркестрация и методы их защиты - Работа с данными

[[Docker]] использует драйверы хранилища (Storage drivers) для хранения слоев изображений и хранения данных в доступном для записи уровне контейнера


![[Pasted image 20241006112503.png]]

## Типы

### Block level

Блочное хранилище разделяет данные на блоки и хранит их как отдельные части 

Блочное хранилище не зависит от единственного пути к данным - в отличие от файлового хранилища его можно получить быстро

Пример блочных storage drivers: DeviceMapper, ZFS

![[Pasted image 20241006112557.png]]

### File level

Файловое хранилище, также называемое хранилищем на уровне - это именно то, что вы думаете: данные хранятся в виде единого фрагмента информации внутри директории.

Это самая старая и наиболее широко используемая система хранения данных для систем хранения с прямым подключением к сети.

Пример файловых storage drivers: AUFS, Overlay, Overlay2

![[Pasted image 20241006112625.png]]

### Object level

Объектное хранилище, также известное как объектно-ориентированное хранилище, представляет собой плоскую структуру, в которой файлы разбиваются на части и распределяются по оборудованию:
- для объектного хранилища требуется простой интерфейс прикладного программирования (API)
- объекты не могут быть изменены
- 
- Примеры ООХ: Ceph, OpenIO
![[Pasted image 20241006112657.png]]

## Форматы хранилищ

- Файловое хранилище организует и представляет данные в виде иерархии файлов в папках 
- Блочное хранилище разбивает данные на произвольно организованные тома одинакового размера 
- Объектное хранилище управляет данными и связывает их со связанными метаданными (не рассматривается в Docker)

![[Pasted image 20241006112735.png]]

![[Pasted image 20241006112741.png]]

Работа с данными Storage driver Overlay2 является драйвером по умолчанию Изменить storage driver можно в конфигурации docker daemon (/etc/docker/daemon.json) Текущий storage driver можно узнать с помощью команды "docker info"

![[Pasted image 20241006112754.png]]

## Какие данные при работе контейнера стоит хранить постоянно?
- базы данных
- логи
- файлы конфигураций 
- настройки пользователей 
- .. и другие

![[Pasted image 20241006112823.png]]

## Docker volumes

Для постоянного хранения данных в docker существует механизм docker volumes, с помощью которых можно: 
- выгружать данные контейнера на персистентное хранение 
- работать в подмонтированных каталогах с интенсивной записью
- совместно использовать выгружаемые данные сразу в нескольких контейнерах 

По умолчанию тома docker volumes создаются в каталоге /var/lib/docker/volumes/

docker volumes в основном применяются в docker-compose

![[Pasted image 20241006112907.png]]

## Работа с сетями

Network Drivers:
- [[Bridge Network Driver]] 
- [[Host network driver]]
- [[Overlay network driver]]
- [[Macvlan network driver]]
- [[None network driver]]
- [[Network plugins]]
## Оптимизация

Основные инструкции в Dockerfile:
- FROM — использование базового образа 
- RUN — выполнение команд и создание слоя образа 
- COPY — копирование в контейнер файлов и папок 
- ADD — аналогично COPY, но с распаковкой архивов 
- LABEL — описание метаданных
- ENV — задание переменных среды 
- ARG — задание переменных для передачи во время сборки
- CMD — описание команд с аргументами для выполнения при запуске контейнера
- ENTRYPOINT — представление команды с аргументами для вызова во время выполнения контейнера
- WORKDIR — задание рабочей директории для следующей инструкции
- EXPOSE — открытие порта в контейнере 
- VOLUME — создание точки монтирования для работы с постоянным хранилищем



Практически каждая команда в Dockerfile создает новый слой Больше слоев - дольше сборка - медленнее запускается и работает контейнер
![[Pasted image 20241006113616.png]]

- Сокращайте инструкции
![[Pasted image 20241006113609.png]]
- очищайте кэш, в т.ч. используемых пакетных менеджеров

![[Pasted image 20241006113627.png]]

- Изменяемые инструкции старайтесь описывать ниже остальных
- сокращайте количество инструкций COPY (так же, как и инструкции RUN)
![[Pasted image 20241006113649.png]]

# Векторы атак

- Уязвимый код
- Настройка контейнеров
![[Pasted image 20241006113730.png]]
- Система сборки
![[Pasted image 20241006113742.png]]
![[Pasted image 20241006113750.png]]
![[Pasted image 20241006113757.png]]

## Топ атак на Docker

```
D01 - Secure User Mapping
D02 - Patch Management Strategy
D03 - Network Segmentation and Firewalling
D04 - Secure Defaults and Hardening
D05 - Maintain Security Contexts
D06 - Protect Secrets
D07 - Resource Protection
D08 - Container Image Integrity and Origin
D09 - Follow Immutable Paradigm
D10 - Logging

D01 — Безопасное сопоставление пользователей
D02 – Стратегия управления исправлениями
D03 — Сегментация сети и межсетевой экран
D04 – Безопасные настройки по умолчанию и усиление защиты
D05 – Поддержание контекстов безопасности
D06 – Защитите секрет
D07 – Защита ресурсов
D08 — Целостность и происхождение образа контейнера
D09 – Следуйте неизменной парадигм
D10 — Ведение журнала
```

## Best practices

 - хост, контейнер, оркестратор - с последними патчами безопасности 
 - установлен пользователь, без флага — privileged 
 - доступ к сокету docker запрещен 
 - соблюден принцип наименьших привилегий 
 - используется флаг –no-new-privilege 
 - взаимодействие между контейнерами запрещено по умолчанию (— icc=false) 
 - корректное монтирование файлов и папок 
 - Dockerfile написан согласно требованиям безопасности
 - установлен соответствующий уровень логирования


## Для выполнения задач, связанных с Docker и проверкой безопасности образа выполним следующие шаги:

### 0. Проверка установлен ли Docker
![[Pasted image 20241006115851.png]]

### 1. Скачать образ Ubuntu 18.04 с hub.docker.io

```sh
docker pull ubuntu:18.04
```
![[Pasted image 20241006115908.png]]

### 2. Проверить целостность и соответствие контрольной суммы образа SHA256

Для проверки контрольной суммы образа, выполним следующую команду:

```sh
docker image inspect ubuntu:18.04 --format '{{.RepoDigests}}'
```


![[Pasted image 20241006115920.png]]

Эта команда покажет хеш-сумму SHA256 образа. Вы можете сравнить её с хеш-суммой на Docker Hub.

### 3. Отобразим все Docker образы в системе

```sh
docker image ls
```

### 4. Добавить пользователя в группу Docker

Для запуска команд Docker без sudo, добавьте вашего пользователя в группу Docker:

```sh
sudo usermod -aG docker $USER
```

После этого необходимимо выйдити из терминала и войдите снова, чтобы изменения вступили в силу.

### 5. Запустить образ в интерактивном режиме в оболочке sh

```sh
docker run -it ubuntu:18.04 sh
```

### 6. Выполнить команду whoami внутри контейнера

Внутри контейнера выполните:

```sh
whoami
```

![[Pasted image 20241006115944.png]]

### 7. Запустить контейнер под пользователем tms

Для запуска контейнера под пользователем `tms`, нужно создать этого пользователя внутри контейнера. Можно сделать с помощью Dockerfile или команды `docker run` с опцией `--user`.

Создадим Dockerfile:

```Dockerfile
FROM ubuntu:18.04
RUN useradd -m tms
USER tms
CMD ["sh"]
```

![[Pasted image 20241006115958.png]]

Соберем образ:

```sh
docker build -t ubuntu-tms:18.04 .
```

Запустим контейнер:

```sh
docker run -it ubuntu-tms:18.04
```


![[Pasted image 20241006120010.png]]

### 8. Проверим образ через сканер безопасности Trivy

Установим Trivy:

```sh
sudo apt-get install wget apt-transport-https gnupg lsb-release
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | sudo tee -a /etc/apt/sources.list.d/trivy.list
sudo apt-get update
sudo apt-get install trivy
```

Просканируем образ:

```sh
trivy image ubuntu:18.04
```


![[Pasted image 20241006120021.png]]

Анализируем результаты сканирования, чтобы убедиться, что образ не содержит уязвимостей.
В нашем случае имеётся предупреждение об устаревшем образе и обнаружение уязвимостей может оказаться недостаточным из-за отсутствия обновлений для системы безопасности . 

# Для защиты можно использовать также:
- [[Honeypot]]
- [[Deception Technology]]
- [[Sandbox]]
- [[Мультифакторная аутентификация (MFA)]]
- [[Динамический контроль доступа]]